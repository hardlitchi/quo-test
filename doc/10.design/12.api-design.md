# API設計書

## 概要
quo-testプロジェクト の REST API 仕様を定義する。
Spring Boot + Kotlin での実装を前提とし、JSON形式でのデータ交換を行う。

## 共通仕様

### ベースURL
```
http://localhost:8081/api
```

### HTTPヘッダー
- `Content-Type: application/json`
- `Accept: application/json`

### 共通レスポンス形式

#### 成功時レスポンス
```json
{
  "success": true,
  "data": { ... },
  "message": null
}
```

#### エラー時レスポンス
```json
{
  "success": false,
  "data": null,
  "message": "エラーメッセージ",
  "errors": [
    {
      "field": "フィールド名",
      "message": "エラー詳細"
    }
  ]
}
```

### HTTPステータスコード規約
- `200 OK`: 成功（取得、更新）
- `201 Created`: 作成成功
- `400 Bad Request`: リクエストエラー（バリデーション違反等）
- `404 Not Found`: リソースが見つからない
- `409 Conflict`: 重複エラー（既存データとの競合）
- `500 Internal Server Error`: サーバー内部エラー

## API エンドポイント

### 1. 著者関連API

#### 1.1 著者登録
**POST** `/api/authors`

##### リクエスト
```json
{
  "name": "夏目漱石",
  "birthDate": "1867-02-09"
}
```

##### レスポンス（201 Created）
```json
{
  "success": true,
  "data": {
    "name": "夏目漱石",
    "birthDate": "1867-02-09",
    "createdAt": "2024-01-01T10:00:00",
    "updatedAt": "2024-01-01T10:00:00"
  },
  "message": "著者を登録しました"
}
```

##### エラーケース
- `400 Bad Request`: バリデーションエラー（名前未入力、生年月日が未来等）
- `409 Conflict`: 同名の著者が既に存在

#### 1.2 著者情報更新
**PUT** `/api/authors/{name}`

##### リクエスト
```json
{
  "birthDate": "1867-02-09"
}
```

##### レスポンス（200 OK）
```json
{
  "success": true,
  "data": {
    "name": "夏目漱石",
    "birthDate": "1867-02-09",
    "createdAt": "2024-01-01T10:00:00",
    "updatedAt": "2024-01-01T12:00:00"
  },
  "message": "著者情報を更新しました"
}
```

##### エラーケース
- `404 Not Found`: 指定された著者が存在しない
- `400 Bad Request`: バリデーションエラー

#### 1.3 著者情報取得
**GET** `/api/authors/{name}`

##### レスポンス（200 OK）
```json
{
  "success": true,
  "data": {
    "name": "夏目漱石",
    "birthDate": "1867-02-09",
    "createdAt": "2024-01-01T10:00:00",
    "updatedAt": "2024-01-01T10:00:00"
  },
  "message": null
}
```

#### 1.4 著者一覧取得
**GET** `/api/authors`

##### レスポンス（200 OK）
```json
{
  "success": true,
  "data": [
    {
      "name": "夏目漱石",
      "birthDate": "1867-02-09",
      "createdAt": "2024-01-01T10:00:00",
      "updatedAt": "2024-01-01T10:00:00"
    }
  ],
  "message": null
}
```

#### 1.5 著者出版書籍一覧取得
**GET** `/api/authors/{name}/books`

##### レスポンス（200 OK）
```json
{
  "success": true,
  "data": [
    {
      "title": "こころ",
      "price": 500,
      "publicationStatus": "PUBLISHED",
      "authors": ["夏目漱石"],
      "createdAt": "2024-01-01T10:00:00",
      "updatedAt": "2024-01-01T10:00:00"
    }
  ],
  "message": null
}
```

### 2. 書籍関連API

#### 2.1 書籍・出版情報登録
**POST** `/api/books`

##### リクエスト
```json
{
  "title": "こころ",
  "price": 500,
  "publicationStatus": "UNPUBLISHED",
  "authors": ["夏目漱石"]
}
```

##### レスポンス（201 Created）
```json
{
  "success": true,
  "data": {
    "title": "こころ",
    "price": 500,
    "publicationStatus": "UNPUBLISHED",
    "authors": ["夏目漱石"],
    "createdAt": "2024-01-01T10:00:00",
    "updatedAt": "2024-01-01T10:00:00"
  },
  "message": "書籍を登録しました"
}
```

##### エラーケース
- `400 Bad Request`: バリデーションエラー（タイトル未入力、価格が負の値、著者が空等）
- `404 Not Found`: 指定された著者が存在しない
- `409 Conflict`: 同タイトルの書籍が既に存在

#### 2.2 書籍・出版情報更新
**PUT** `/api/books/{title}`

##### リクエスト
```json
{
  "price": 600,
  "publicationStatus": "PUBLISHED",
  "authors": ["夏目漱石"]
}
```

##### レスポンス（200 OK）
```json
{
  "success": true,
  "data": {
    "title": "こころ",
    "price": 600,
    "publicationStatus": "PUBLISHED",
    "authors": ["夏目漱石"],
    "createdAt": "2024-01-01T10:00:00",
    "updatedAt": "2024-01-01T12:00:00"
  },
  "message": "書籍情報を更新しました"
}
```

##### エラーケース
- `404 Not Found`: 指定された書籍が存在しない
- `400 Bad Request`: バリデーションエラー、出版済み→未出版への変更試行
- `409 Conflict`: ビジネスルール違反（出版済み書籍の未出版化等）

#### 2.3 書籍情報取得
**GET** `/api/books/{title}`

##### レスポンス（200 OK）
```json
{
  "success": true,
  "data": {
    "title": "こころ",
    "price": 500,
    "publicationStatus": "PUBLISHED",
    "authors": ["夏目漱石"],
    "createdAt": "2024-01-01T10:00:00",
    "updatedAt": "2024-01-01T10:00:00"
  },
  "message": null
}
```

#### 2.4 書籍一覧取得
**GET** `/api/books`

##### クエリパラメータ
- `status`: 出版状況でフィルタ（PUBLISHED, UNPUBLISHED）
- `author`: 著者名でフィルタ

##### レスポンス（200 OK）
```json
{
  "success": true,
  "data": [
    {
      "title": "こころ",
      "price": 500,
      "publicationStatus": "PUBLISHED",
      "authors": ["夏目漱石"],
      "createdAt": "2024-01-01T10:00:00",
      "updatedAt": "2024-01-01T10:00:00"
    }
  ],
  "message": null
}
```

## バリデーション仕様

### 著者（Author）
- `name`: 必須、空白不可、最大100文字
- `birthDate`: 必須、現在日付より過去であること

### 書籍（Book）
- `title`: 必須、空白不可、最大200文字
- `price`: 必須、0以上の数値
- `publicationStatus`: 必須、PUBLISHED または UNPUBLISHED
- `authors`: 必須、最低1人の著者、各著者名は存在すること

### ビジネスルール
- 出版済み書籍は未出版状態に戻せない
- 書籍には最低1人の著者が必要
- 重複するタイトルの書籍は登録不可
- 重複する名前の著者は登録不可

## エラーハンドリング

### グローバル例外処理
- バリデーションエラー → 400 Bad Request
- リソース未発見 → 404 Not Found  
- ビジネスルール違反 → 409 Conflict
- 予期しないエラー → 500 Internal Server Error

### エラーメッセージ形式
日本語でユーザーフレンドリーなメッセージを提供する。

## セキュリティ
現在の実装では認証・認可は不要とするが、将来的な拡張を考慮した設計とする。