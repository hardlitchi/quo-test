
# 開発環境構築手順

## 前提条件
- Java 21がインストールされていること（SDKMANでの環境構築を推奨）
- Dockerがインストールされていること（データベース用）

## 0. Java 21環境構築（SDKMAN使用）
### SDKMANのインストール
```bash
# 必要なパッケージをインストール
sudo apt update && sudo apt install -y unzip zip curl

# SDKMANをインストール
curl -s "https://get.sdkman.io" | bash

# 設定を反映（新しいターミナルを開くか以下を実行）
source "$HOME/.sdkman/bin/sdkman-init.sh"
```

### Java 21のインストール
```bash
# 利用可能なJava 21バージョンを確認
sdk list java | grep "21\."

# Java 21をインストール（デフォルトのTemurinを使用）
sdk install java 21.0.7-tem

# インストール確認
java -version
javac -version
```

### SDKMANのバージョン管理Tips
- **現在のJavaバージョン確認**: `sdk current java`
- **バージョン一時切り替え**: `sdk use java <version>` （現在のセッションのみ）
- **デフォルトバージョン変更**: `sdk default java <version>` （全セッションで適用）
- **インストール済みバージョン確認**: `sdk list java | grep installed`
- **複数バージョンの管理例**:
  ```bash
  # Java 17もインストール
  sdk install java 17.0.12-tem
  
  # プロジェクトごとにバージョンを切り替え
  sdk use java 21.0.7-tem    # このプロジェクト用
  sdk use java 17.0.12-tem   # 他のプロジェクト用
  ```

### 手動インストール（代替方法）
Oracle公式ドキュメントに従って手動でJDK 21をインストールすることも可能です。
- 参考: https://docs.oracle.com/javase/jp/21/install/installation-jdk-linux-platforms.html

## 1. プロジェクトのクローン・取得
```bash
# プロジェクトディレクトリに移動
cd quo-test
```

## 2. データベースの起動
PostgreSQLをDocker Composeで起動します。
```bash
# PostgreSQLコンテナをバックグラウンドで起動
docker compose up -d

# 起動確認
docker compose ps
```

## 3. アプリケーションのビルド
```bash
# Gradleラッパーを使用してビルド
./gradlew build
```

## 4. アプリケーションの起動
```bash
# Spring Bootアプリケーションを起動
./gradlew bootRun
```

アプリケーションは http://localhost:8081 で起動します。

## 5. データベース初期化（初回のみ）
データベースのテーブルを作成する際は、以下の手順で行います：

1. Flywayマイグレーションファイルを作成
2. application.ymlでFlyway設定を有効化
3. jOOQコード生成を実行

```bash
# Flywayマイグレーション実行
./gradlew flywayMigrate

# jOOQクラス生成
./gradlew generateJooq
```

## 開発用コマンド
```bash
# テスト実行
./gradlew test

# アプリケーション停止時のデータベース停止
docker compose down

# データベースボリューム含めて削除（データ初期化）
docker compose down -v
```

## トラブルシューティング
- ポート8081が使用中の場合：application.ymlのserver.portを変更
- データベース接続エラー：PostgreSQLコンテナが起動しているか確認
- ビルドエラー：Java 21が正しくインストールされているか確認
